# 格式差异对比工具 使用说明

## 📁 文件说明

- `format_diff_server.py` - 差异分析脚本
- `format_diffs.json` - 生成的差异数据（自动生成）
- `format_diff_viewer_standalone.html` - 差异查看器（离线版）

## 🚀 快速开始

### 1. 生成差异数据

```bash
python3 format_diff_server.py
```

这将：
- 分析模板文档和转换后文档的格式差异
- 自动过滤掉内容差异，只保留格式差异
- 生成 `format_diffs.json` 文件

### 2. 查看差异

**方法 1：直接打开（推荐）**
```bash
# macOS
open format_diff_viewer_standalone.html

# Linux
xdg-open format_diff_viewer_standalone.html

# Windows
start format_diff_viewer_standalone.html
```

**方法 2：使用 Web 服务器**
```bash
python3 -m http.server 8000
# 然后访问: http://localhost:8000/format_diff_viewer_standalone.html
```

## 🎯 功能特性

### ✨ 自动过滤内容差异

工具会智能识别并过滤以下类型的内容差异：
- 中文字符差异（如 "头脑风暴法" vs "头脑风爆法"）
- 文本内容变化
- 只保留**纯格式差异**，如：
  - ✅ 样式属性差异（`w:pStyle w:val="a3"` vs `w:pStyle w:val="afc"`）
  - ✅ XML 结构差异
  - ✅ 标点符号差异（空格、逗号等）

### 🎨 差异类型标识

- 🔵 **样式差异** - 颜色标识：蓝色
- 🟠 **结构差异** - 颜色标识：橙色
- 🟢 **标点符号差异** - 颜色标识：绿色

### 🎮 交互功能

- **左右对比** - 并排显示模板和输出文档
- **高亮差异** - 自动高亮差异字符
- **导航控制** - 上一个/下一个/第一个差异
- **键盘快捷键**:
  - `←` 上一个差异
  - `→` 下一个差异
  - `Home` 跳转到第一个差异
- **完整上下文** - 显示每个差异周围的完整 XML 代码

## 📊 输出示例

```
📊 统计信息:
   • 第一个差异位置: 34,546
   • 格式差异总数: 50 处
   • 相似度: 99.51%
```

## 🔧 自定义配置

如需修改对比的文档，编辑 `format_diff_server.py` 中的配置：

```python
TEMPLATE_PATH = Path('你的模板.docx')
OUTPUT_PATH = Path('你的输出.docx')
```

## 💡 使用技巧

1. **专注于格式优化** - 工具已自动过滤内容差异，让你专注于格式问题
2. **快速定位** - 使用"第一个差异"按钮快速跳转到最早的问题
3. **上下文分析** - 查看完整 XML 上下文，理解差异的根源
4. **批量修复** - 根据差异列表，批量修复相同类型的格式问题

## 🎨 界面预览

```
┌──────────────────────────────────────────────────────────────┐
│ 📊 格式差异对比工具                                            │
├──────────────────────┬─────────────────────────────────────┤
│ 📄 模板文档            │ 📄 转换后文档                         │
│ 83,944 字符          │ 83,159 字符                          │
├──────────────────────┼─────────────────────────────────────┤
│ 📍 位置 34546         │ 📍 位置 34546                         │
│ [样式差异]            │ [样式差异]                            │
│                      │                                      │
│ 差异字符: '3' vs 'a'  │ 差异字符: '3' vs 'a'                 │
│ 前文: ...w:val="a     │ 前文: ...w:val="a                    │
│                      │                                      │
│ 完整上下文:           │ 完整上下文:                           │
│ <w:pStyle w:val="a3" │ <w:pStyle w:val="afc"                │
│ ...                  │ ...                                  │
└──────────────────────┴─────────────────────────────────────┘

    ⬅️ 上一个    差异 1 / 50    下一个 ➡️    🎯 第一个差异
```

## 📝 注意事项

- 工具只分析格式差异，内容差异会被自动跳过
- 默认最多显示 50 个格式差异（可在代码中调整）
- 建议在 Chrome/Edge/Firefox 等现代浏览器中查看

## 🆘 常见问题

**Q: 为什么有些差异没有显示？**
A: 工具自动过滤了内容差异（如中文文本变化），只显示纯格式差异。

**Q: 如何重新生成差异数据？**
A: 重新运行 `python3 format_diff_server.py` 即可。

**Q: 可以对比其他文档吗？**
A: 可以，修改 `format_diff_server.py` 中的路径配置即可。
