# 格式相似度指标说明

## 📊 相似度输出示例

### 示例1: 格式定义文件对比（推荐）

```bash
# 仅对比格式定义文件（styles.xml, numbering.xml等）
python -m restorer.cli compare 标准格式.docx 输出.docx --no-full
```

**输出：**
```
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
📊 格式对比报告
格式基准文档: 标准格式.docx
待验证文档: 输出.docx
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

⚠️  内容检查: 文档内容不一致
  ℹ️  注意: 格式相似度仍然可以用于评估格式还原效果

📋 XML文件对比:
  ✓ word/fontTable.xml: 完全一致
  ✓ word/numbering.xml: 完全一致
  ✓ word/settings.xml: 完全一致
  ✓ word/styles.xml: 完全一致

📈 整体格式相似度: 100.0%

✅ 结论: 格式还原完全成功！
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
```

### 示例2: 全量XML文件对比

```bash
# 对比所有XML文件（包括document.xml等）
python -m restorer.cli compare 标准格式.docx 输出.docx
```

**输出：**
```
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
📊 格式对比报告
格式基准文档: 标准格式.docx
待验证文档: 输出.docx
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

⚠️  内容检查: 文档内容不一致
  ℹ️  注意: 格式相似度仍然可以用于评估格式还原效果

📋 XML文件对比:
  • [Content_Types].xml: 相似度 77.4%
  ✓ word/fontTable.xml: 完全一致
  • word/document.xml: 相似度 60.2%  (内容不同导致)
  ✓ word/numbering.xml: 完全一致
  ✓ word/settings.xml: 完全一致
  ✓ word/styles.xml: 完全一致
  ...

📈 整体格式相似度: 46.7%

⚠️  结论: 格式还原部分成功，建议检查差异。
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
```

## 📈 相似度计算方式

### 1. 格式文件相似度（最重要）

**对比文件：**
- `word/styles.xml` - 样式定义
- `word/numbering.xml` - 编号定义
- `word/settings.xml` - 文档设置
- `word/fontTable.xml` - 字体表

**计算方式：**
- XML节点结构对比
- 属性值对比
- 过滤非确定性字段（rsid、时间戳等）

**结果解读：**
- **100%**: 格式定义完全一致 ✅
- **90-99%**: 格式基本一致，有轻微差异 ⚠️
- **< 90%**: 格式存在明显差异 ❌

### 2. 整体相似度（包含内容文件）

**对比范围：**
- 所有格式文件
- `word/document.xml` - 主文档内容
- `word/header*.xml` - 页眉
- `word/footer*.xml` - 页脚
- 等所有XML文件

**结果解读：**
- 由于内容不同，`document.xml`等文件的相似度会较低
- **这不代表格式还原失败**，只是说明内容不同
- 建议使用 `--no-full` 参数仅对比格式文件

## 🎯 使用建议

### 场景1: 验证格式还原是否成功（推荐）

```bash
# 使用 --no-full 参数，仅对比格式定义文件
python -m restorer.cli compare 标准格式.docx 输出.docx --no-full
```

**预期结果：**
- 如果格式还原成功，格式文件相似度应为 **100%**
- 即使文档内容不同，格式定义也应该完全一致

### 场景2: 检查具体哪个文件有差异

```bash
# 对比特定文件
python -m restorer.cli compare 标准格式.docx 输出.docx --file word/styles.xml
```

**输出：**
```
✓ word/styles.xml: 完全一致
```
或
```
• word/styles.xml: 相似度 85.3%
```

### 场景3: 内容完全一致的文档对比

如果两个文档内容完全相同（例如，同一文档的不同版本）：

```bash
# 全量对比
python -m restorer.cli compare 标准格式.docx 输出.docx
```

**预期结果：**
```
✅ 内容检查: 文档内容一致
  ℹ️  可进行完整的格式验证

📋 XML文件对比:
  ✓ word/fontTable.xml: 完全一致
  ✓ word/document.xml: 完全一致
  ✓ word/styles.xml: 完全一致
  ...

📈 整体格式相似度: 100.0%

✅ 结论: 格式还原完全成功！
```

## 🔍 相似度等级说明

| 相似度 | 含义 | 建议 |
|--------|------|------|
| 100% | 完全一致 | ✅ 格式还原完美 |
| 90-99% | 基本一致 | ⚠️ 有轻微差异，通常可接受 |
| 70-89% | 部分一致 | ⚠️ 有明显差异，建议检查 |
| < 70% | 差异较大 | ❌ 格式还原可能失败 |

## 💡 最佳实践

1. **使用 `--no-full` 参数**
   - 仅对比格式定义文件
   - 避免内容差异影响判断
   - 这是最准确的格式还原验证方式

2. **关注格式文件的一致性**
   - `styles.xml` - 最重要
   - `numbering.xml` - 编号样式
   - `settings.xml` - 文档设置
   - `fontTable.xml` - 字体表

3. **不要过度关注整体相似度**
   - 全量对比时，内容不同会导致相似度下降
   - 这是正常的，不代表格式还原失败
   - 重点看格式文件的相似度

4. **人工验证**
   - 打开Word文档查看视觉效果
   - 检查关键格式（标题、段落、表格等）
   - 结合相似度指标和视觉效果综合判断

## 📝 总结

✅ **工具会自动输出详细的相似度指标**：
- 每个XML文件的相似度
- 整体格式相似度
- 明确的成功/失败结论

✅ **推荐使用 `--no-full` 参数**：
- 仅对比格式定义文件
- 更准确地评估格式还原效果
- 避免内容差异干扰

✅ **相似度100% = 格式还原成功**：
- 格式定义文件完全一致
- 可以放心使用
