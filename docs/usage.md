# Word Format Restorer - ä½¿ç”¨æŒ‡å—

## ç›®å½•

1. [å¿«é€Ÿå¼€å§‹](#å¿«é€Ÿå¼€å§‹)
2. [å®‰è£…è¯´æ˜](#å®‰è£…è¯´æ˜)
3. [åŸºæœ¬ç”¨æ³•](#åŸºæœ¬ç”¨æ³•)
4. [é«˜çº§ç”¨æ³•](#é«˜çº§ç”¨æ³•)
5. [æœ€ä½³å®è·µ](#æœ€ä½³å®è·µ)
6. [å¸¸è§é—®é¢˜](#å¸¸è§é—®é¢˜)
7. [æ•…éšœæ’é™¤](#æ•…éšœæ’é™¤)

---

## å¿«é€Ÿå¼€å§‹

### 5åˆ†é’Ÿä¸Šæ‰‹

```bash
# 1. å®‰è£…ä¾èµ–
pip install lxml

# 2. è¿˜åŸæ ¼å¼
python -m restorer.cli æ ‡å‡†æ ¼å¼.docx å¾…å¤„ç†.docx

# 3. éªŒè¯ç»“æœ
python -m restorer.cli --compare æ ‡å‡†æ ¼å¼.docx å¾…å¤„ç†_å·²æ ¼å¼åŒ–.docx
```

---

## å®‰è£…è¯´æ˜

### ç³»ç»Ÿè¦æ±‚

- Python 3.7 æˆ–æ›´é«˜ç‰ˆæœ¬
- lxml 4.9.0 æˆ–æ›´é«˜ç‰ˆæœ¬

### å®‰è£…æ­¥éª¤

#### macOS / Linux

```bash
# å…‹éš†ä»“åº“
git clone https://github.com/yourusername/word-format-restorer.git
cd word-format-restorer

# åˆ›å»ºè™šæ‹Ÿç¯å¢ƒï¼ˆæ¨èï¼‰
python3 -m venv venv
source venv/bin/activate

# å®‰è£…ä¾èµ–
pip install lxml
```

#### Windows

```cmd
# å…‹éš†ä»“åº“
git clone https://github.com/yourusername/word-format-restorer.git
cd word-format-restorer

# åˆ›å»ºè™šæ‹Ÿç¯å¢ƒï¼ˆæ¨èï¼‰
python -m venv venv
venv\Scripts\activate

# å®‰è£…ä¾èµ–
pip install lxml
```

### éªŒè¯å®‰è£…

```bash
python -m restorer.cli --help
```

å¦‚æœçœ‹åˆ°å¸®åŠ©ä¿¡æ¯ï¼Œè¯´æ˜å®‰è£…æˆåŠŸã€‚

---

## åŸºæœ¬ç”¨æ³•

### 1. è¿˜åŸå•ä¸ªæ–‡æ¡£æ ¼å¼

æœ€ç®€å•çš„ç”¨æ³•ï¼š

```bash
python -m restorer.cli æ ‡å‡†æ ¼å¼.docx å¾…å¤„ç†.docx
```

è¿™ä¼šç”Ÿæˆ `å¾…å¤„ç†_å·²æ ¼å¼åŒ–.docx` æ–‡ä»¶ã€‚

æŒ‡å®šè¾“å‡ºæ–‡ä»¶åï¼š

```bash
python -m restorer.cli æ ‡å‡†æ ¼å¼.docx å¾…å¤„ç†.docx -o è¾“å‡º.docx
```

ä½¿ç”¨å­å‘½ä»¤æ ¼å¼ï¼ˆæ›´æ˜ç¡®ï¼‰ï¼š

```bash
python -m restorer.cli restore æ ‡å‡†æ ¼å¼.docx å¾…å¤„ç†.docx -o è¾“å‡º.docx
```

### 2. æ‰¹é‡è¿˜åŸæ ¼å¼

å¤„ç†å¤šä¸ªæ–‡ä»¶ï¼š

```bash
python -m restorer.cli batch æ ‡å‡†æ ¼å¼.docx æ–‡ä»¶1.docx æ–‡ä»¶2.docx æ–‡ä»¶3.docx
```

ä½¿ç”¨é€šé…ç¬¦ï¼š

```bash
# å¤„ç†å½“å‰ç›®å½•æ‰€æœ‰docxæ–‡ä»¶
python -m restorer.cli batch æ ‡å‡†æ ¼å¼.docx *.docx

# å¤„ç†ç‰¹å®šç›®å½•çš„æ–‡ä»¶
python -m restorer.cli batch æ ‡å‡†æ ¼å¼.docx contracts/*.docx
```

æŒ‡å®šè¾“å‡ºç›®å½•ï¼š

```bash
python -m restorer.cli batch æ ‡å‡†æ ¼å¼.docx contracts/*.docx -o formatted/
```

### 3. å¯¹æ¯”æ–‡æ¡£æ ¼å¼

#### å…¨é‡å¯¹æ¯”ï¼ˆæ¨èï¼‰

å¯¹æ¯”æ‰€æœ‰XMLæ–‡ä»¶ï¼š

```bash
python -m restorer.cli compare æ ‡å‡†æ ¼å¼.docx è¾“å‡ºæ–‡æ¡£.docx
```

æˆ–ä½¿ç”¨ä¼ ç»Ÿæ¥å£ï¼š

```bash
python -m restorer.cli --compare æ ‡å‡†æ ¼å¼.docx è¾“å‡ºæ–‡æ¡£.docx
```

#### ä»…å¯¹æ¯”ç‰¹å®šæ–‡ä»¶

å¯¹æ¯”æŒ‡å®šçš„XMLæ–‡ä»¶ï¼š

```bash
# ä»…å¯¹æ¯”æ ·å¼æ–‡ä»¶
python -m restorer.cli compare æ ‡å‡†æ ¼å¼.docx è¾“å‡ºæ–‡æ¡£.docx --file styles.xml

# ä»…å¯¹æ¯”ç¼–å·æ–‡ä»¶
python -m restorer.cli compare æ ‡å‡†æ ¼å¼.docx è¾“å‡ºæ–‡æ¡£.docx --file numbering.xml
```

#### ä»…å¯¹æ¯”æ ¼å¼å®šä¹‰æ–‡ä»¶

ä¸åŒ…å«document.xmlç­‰å†…å®¹æ–‡ä»¶ï¼š

```bash
python -m restorer.cli compare æ ‡å‡†æ ¼å¼.docx è¾“å‡ºæ–‡æ¡£.docx --no-full
```

---

## é«˜çº§ç”¨æ³•

### 1. ç†è§£æ ¼å¼å¯¹æ¯”æŠ¥å‘Š

#### å®Œå…¨ä¸€è‡´çš„æƒ…å†µ

```
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
ğŸ“Š æ ¼å¼å¯¹æ¯”æŠ¥å‘Š
æ ¼å¼åŸºå‡†æ–‡æ¡£: examples/æ­£å¸¸æ ¼å¼.docx
å¾…éªŒè¯æ–‡æ¡£: examples/é”™ä¹±æ ¼å¼_å·²è¿˜åŸ.docx
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

âœ… XMLæ–‡ä»¶å¯¹æ¯”:
  â€¢ styles.xml: å®Œå…¨ä¸€è‡´ âœ“
  â€¢ numbering.xml: å®Œå…¨ä¸€è‡´ âœ“
  â€¢ settings.xml: å®Œå…¨ä¸€è‡´ âœ“
  â€¢ fontTable.xml: å®Œå…¨ä¸€è‡´ âœ“

ğŸ“ˆ æ ¼å¼ç›¸ä¼¼åº¦: 100%

âœ… ç»“è®º: æ ¼å¼è¿˜åŸå®Œå…¨æˆåŠŸï¼
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
```

#### å†…å®¹ä¸ä¸€è‡´çš„æƒ…å†µ

```
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
ğŸ“Š æ ¼å¼å¯¹æ¯”æŠ¥å‘Š
æ ¼å¼åŸºå‡†æ–‡æ¡£: examples/æ­£å¸¸æ ¼å¼.docx
å¾…éªŒè¯æ–‡æ¡£: examples/é”™ä¹±æ ¼å¼_å·²è¿˜åŸ.docx
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

âŒ å†…å®¹ä¸ä¸€è‡´:
  Documents have different content.

â„¹ï¸  è¯´æ˜: ä»…åœ¨å†…å®¹å®Œå…¨ä¸€è‡´æ—¶æ‰è¿›è¡Œæ ¼å¼å¯¹æ¯”éªŒè¯
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
```

è¿™ç§æƒ…å†µè¡¨ç¤ºä¸¤ä¸ªæ–‡æ¡£çš„å†…å®¹ä¸åŒï¼Œå› æ­¤æ— æ³•è¿›è¡Œæ ¼å¼å¯¹æ¯”éªŒè¯ã€‚è¿™æ˜¯æ­£å¸¸çš„ï¼Œå› ä¸ºï¼š

- æ ‡å‡†æ ¼å¼æ–‡æ¡£å’Œå¾…å¤„ç†æ–‡æ¡£æœ¬èº«å†…å®¹ä¸åŒ
- æ ¼å¼è¿˜åŸå·¥å…·ä¸ä¼šæ”¹å˜æ–‡æ¡£å†…å®¹
- ä»…å½“å†…å®¹å®Œå…¨ä¸€è‡´æ—¶ï¼Œæ‰è¦æ±‚XML 100%ä¸€è‡´

### 2. æ‰¹é‡å¤„ç†æœ€ä½³å®è·µ

#### å¤„ç†å‰å¤‡ä»½

```bash
# åˆ›å»ºå¤‡ä»½ç›®å½•
mkdir -p backup
cp contracts/*.docx backup/

# æ‰¹é‡å¤„ç†
python -m restorer.cli batch æ ‡å‡†æ ¼å¼.docx contracts/*.docx -o formatted/
```

#### æ£€æŸ¥å¤„ç†ç»“æœ

```bash
# ç»Ÿè®¡æˆåŠŸ/å¤±è´¥æ•°é‡
python -m restorer.cli batch æ ‡å‡†æ ¼å¼.docx contracts/*.docx -o formatted/

# è¾“å‡ºç¤ºä¾‹ï¼š
# âœ… æˆåŠŸå¤„ç† 8 ä¸ªæ–‡ä»¶:
#   â€¢ formatted/åˆåŒ1_å·²æ ¼å¼åŒ–.docx
#   ...
# âŒ 2 ä¸ªæ–‡ä»¶å¤„ç†å¤±è´¥:
#   â€¢ File not found: contracts/missing.docx
```

### 3. é›†æˆåˆ°è‡ªåŠ¨åŒ–æµç¨‹

#### Shellè„šæœ¬

```bash
#!/bin/bash
# format_contracts.sh

TEMPLATE="æ ‡å‡†åˆåŒæ¨¡æ¿.docx"
INPUT_DIR="contracts"
OUTPUT_DIR="formatted_contracts"

# åˆ›å»ºè¾“å‡ºç›®å½•
mkdir -p "$OUTPUT_DIR"

# æ‰¹é‡å¤„ç†
python -m restorer.cli batch "$TEMPLATE" "$INPUT_DIR"/*.docx -o "$OUTPUT_DIR"

# éªŒè¯ç¬¬ä¸€ä¸ªæ–‡ä»¶
FIRST_FILE=$(ls "$OUTPUT_DIR"/*.docx | head -1)
python -m restorer.cli compare "$TEMPLATE" "$FIRST_FILE"
```

#### Pythonè„šæœ¬

```python
#!/usr/bin/env python3
# format_contracts.py

from pathlib import Path
from restorer.core import FormatRestorer
from restorer.comparer import FormatComparer

# é…ç½®
template = "æ ‡å‡†åˆåŒæ¨¡æ¿.docx"
input_dir = Path("contracts")
output_dir = Path("formatted_contracts")

# åˆ›å»ºè¾“å‡ºç›®å½•
output_dir.mkdir(exist_ok=True)

# åˆå§‹åŒ–å·¥å…·
restorer = FormatRestorer(template)
comparer = FormatComparer()

# æ‰¹é‡å¤„ç†
docx_files = list(input_dir.glob("*.docx"))
output_files, errors = restorer.restore_batch(
    [str(f) for f in docx_files],
    str(output_dir)
)

# æŠ¥å‘Šç»“æœ
print(f"âœ… æˆåŠŸ: {len(output_files)} ä¸ª")
print(f"âŒ å¤±è´¥: {len(errors)} ä¸ª")

# å¯é€‰ï¼šéªŒè¯ç¬¬ä¸€ä¸ªæ–‡ä»¶
if output_files:
    result = comparer.compare_documents(template, output_files[0])
    report = comparer.generate_report(result, template, output_files[0])
    print("\néªŒè¯æŠ¥å‘Š:")
    print(report)
```

---

## æœ€ä½³å®è·µ

### 1. å‡†å¤‡æ ‡å‡†æ ¼å¼æ–‡æ¡£

- âœ… ä½¿ç”¨å¹²å‡€ã€æ ¼å¼è§„èŒƒçš„æ–‡æ¡£ä½œä¸ºæ¨¡æ¿
- âœ… ç¡®ä¿æ‰€æœ‰æ ·å¼éƒ½å·²å®šä¹‰ï¼ˆé¿å…ç›´æ¥æ ¼å¼ï¼‰
- âœ… æµ‹è¯•æ¨¡æ¿çš„å…¼å®¹æ€§ï¼ˆç”¨ä¸åŒçš„å¾…å¤„ç†æ–‡æ¡£æµ‹è¯•ï¼‰
- âŒ é¿å…ä½¿ç”¨åŒ…å«å®æˆ–å…¶ä»–ç‰¹æ®ŠåŠŸèƒ½çš„æ–‡æ¡£

### 2. éªŒè¯å¤„ç†ç»“æœ

```bash
# 1. æ ¼å¼è¿˜åŸ
python -m restorer.cli æ ‡å‡†æ ¼å¼.docx å¾…å¤„ç†.docx

# 2. å¯¹æ¯”éªŒè¯
python -m restorer.cli compare æ ‡å‡†æ ¼å¼.docx å¾…å¤„ç†_å·²æ ¼å¼åŒ–.docx

# 3. æ‰“å¼€Wordæ£€æŸ¥è§†è§‰æ•ˆæœ
open å¾…å¤„ç†_å·²æ ¼å¼åŒ–.docx  # macOS
start å¾…å¤„ç†_å·²æ ¼å¼åŒ–.docx  # Windows
```

### 3. æ‰¹é‡å¤„ç†ç­–ç•¥

```bash
# å¤„ç†å‰
1. å¤‡ä»½åŸå§‹æ–‡ä»¶
2. å°è§„æ¨¡æµ‹è¯•ï¼ˆ1-2ä¸ªæ–‡ä»¶ï¼‰
3. éªŒè¯æµ‹è¯•ç»“æœ

# å¤„ç†ä¸­
4. ä½¿ç”¨æ‰¹é‡å‘½ä»¤å¤„ç†æ‰€æœ‰æ–‡ä»¶
5. æŸ¥çœ‹æˆåŠŸ/å¤±è´¥ç»Ÿè®¡

# å¤„ç†å
6. æŠ½æŸ¥éªŒè¯ï¼ˆ10-20%çš„æ–‡ä»¶ï¼‰
7. äººå·¥æ£€æŸ¥å…³é”®æ–‡æ¡£
```

### 4. æ€§èƒ½ä¼˜åŒ–

- å•æ–‡æ¡£å¤„ç†: < 1ç§’
- 100æ–‡æ¡£æ‰¹é‡å¤„ç†: < 2åˆ†é’Ÿ
- å†…å­˜å ç”¨: < 100MB

å¦‚éœ€æ›´å¿«çš„é€Ÿåº¦ï¼š

```bash
# ä½¿ç”¨å¤šè¿›ç¨‹ï¼ˆé€‚ç”¨äºè¶…å¤§æ‰¹é‡ï¼‰
find contracts -name "*.docx" | parallel -j 4 \
  'python -m restorer.cli æ ‡å‡†æ ¼å¼.docx {} -o formatted/{/}'
```

---

## å¸¸è§é—®é¢˜

### Q1: ä¸ºä»€ä¹ˆæ ¼å¼å¯¹æ¯”æ˜¾ç¤º"å†…å®¹ä¸ä¸€è‡´"ï¼Ÿ

**A**: è¿™æ˜¯æ­£å¸¸çš„ã€‚æ ¼å¼å¯¹æ¯”çš„XML 100%ä¸€è‡´æ€§éªŒè¯ï¼Œä»…åœ¨å†…å®¹å®Œå…¨ä¸€è‡´çš„å‰æä¸‹æ‰é€‚ç”¨ã€‚

- æ ‡å‡†æ ¼å¼æ–‡æ¡£å’Œå¾…å¤„ç†æ–‡æ¡£æœ¬èº«å†…å®¹ä¸åŒ
- å·¥å…·åªä¿®æ”¹æ ¼å¼ï¼Œä¸æ”¹å˜å†…å®¹
- å› æ­¤å†…å®¹ä¸ä¸€è‡´æ˜¯é¢„æœŸè¡Œä¸º

**è§£å†³æ–¹æ¡ˆ**:
- å¦‚æœè¦éªŒè¯æ ¼å¼è¿˜åŸæ˜¯å¦æ­£ç¡®ï¼Œéœ€è¦ç”¨å†…å®¹å®Œå…¨ç›¸åŒçš„æ–‡æ¡£è¿›è¡Œå¯¹æ¯”
- æˆ–è€…äººå·¥æ£€æŸ¥è§†è§‰æ•ˆæœ

### Q2: å¤„ç†åçš„æ–‡æ¡£æ ¼å¼ä¸å®Œå…¨ä¸€è‡´ï¼Ÿ

**A**: å¯èƒ½çš„åŸå› ï¼š

1. **æ¨¡æ¿æ–‡æ¡£åŒ…å«ç›´æ¥æ ¼å¼**
   - è§£å†³æ–¹æ¡ˆï¼šæ¸…ç†æ¨¡æ¿æ–‡æ¡£ï¼Œä½¿ç”¨æ ·å¼è€Œéç›´æ¥æ ¼å¼

2. **å¾…å¤„ç†æ–‡æ¡£æœ‰ç‰¹æ®Šçš„æ ¼å¼é™åˆ¶**
   - è§£å†³æ–¹æ¡ˆï¼šæ£€æŸ¥åŸå§‹æ–‡æ¡£ï¼Œç¡®ä¿æ ¼å¼å¯ä»¥è¢«è¦†ç›–

3. **Wordç‰ˆæœ¬å…¼å®¹æ€§é—®é¢˜**
   - è§£å†³æ–¹æ¡ˆï¼šä½¿ç”¨ç›¸åŒç‰ˆæœ¬çš„Wordåˆ›å»ºæ¨¡æ¿å’Œå¾…å¤„ç†æ–‡æ¡£

### Q3: æ‰¹é‡å¤„ç†æ—¶éƒ¨åˆ†æ–‡ä»¶å¤±è´¥ï¼Ÿ

**A**: å¸¸è§åŸå› ï¼š

1. **æ–‡ä»¶è·¯å¾„é”™è¯¯**
   ```bash
   # æ£€æŸ¥æ–‡ä»¶æ˜¯å¦å­˜åœ¨
   ls contracts/*.docx
   ```

2. **æ–‡ä»¶æ­£åœ¨è¢«å…¶ä»–ç¨‹åºå ç”¨**
   - è§£å†³æ–¹æ¡ˆï¼šå…³é—­Wordæˆ–å…¶ä»–ç¨‹åºåé‡è¯•

3. **æ–‡æ¡£æŸå**
   - è§£å†³æ–¹æ¡ˆï¼šä½¿ç”¨Wordçš„ä¿®å¤åŠŸèƒ½æ‰“å¼€å¹¶ä¿å­˜æ–‡æ¡£

### Q4: å¦‚ä½•å¤„ç†é¡µçœ‰é¡µè„šï¼Ÿ

**A**: å·¥å…·ä¼šä¿ç•™ç›®æ ‡æ–‡æ¡£çš„é¡µçœ‰é¡µè„šå†…å®¹ï¼Œä¸è¦†ç›–ã€‚

- é¡µçœ‰é¡µè„šçš„æ ¼å¼ä¼šæŒ‰ç…§æ¨¡æ¿è°ƒæ•´
- ä½†å†…å®¹ä¿æŒä¸å˜

### Q5: æ”¯æŒå“ªäº›Wordæ ¼å¼ï¼Ÿ

**A**: ä»…æ”¯æŒ `.docx` æ ¼å¼ï¼ˆWord 2007+ï¼‰

- ä¸æ”¯æŒ `.doc` æ ¼å¼ï¼ˆWord 97-2003ï¼‰
- ä¸æ”¯æŒ `.dot`, `.dotm` ç­‰æ¨¡æ¿æ ¼å¼

---

## æ•…éšœæ’é™¤

### é—®é¢˜1: ImportError: No module named 'lxml'

**è§£å†³æ–¹æ¡ˆ**:
```bash
pip install lxml
```

### é—®é¢˜2: FileNotFoundError: Template file not found

**è§£å†³æ–¹æ¡ˆ**:
```bash
# æ£€æŸ¥æ–‡ä»¶è·¯å¾„
ls æ ‡å‡†æ ¼å¼.docx

# ä½¿ç”¨ç»å¯¹è·¯å¾„
python -m restorer.cli /full/path/to/æ ‡å‡†æ ¼å¼.docx å¾…å¤„ç†.docx
```

### é—®é¢˜3: å¤„ç†é€Ÿåº¦æ…¢

**è§£å†³æ–¹æ¡ˆ**:
1. æ£€æŸ¥æ˜¯å¦æœ‰æ€æ¯’è½¯ä»¶å¹²æ‰°
2. ä½¿ç”¨SSDç¡¬ç›˜
3. å…³é—­ä¸å¿…è¦çš„åå°ç¨‹åº

### é—®é¢˜4: è¾“å‡ºæ–‡æ¡£æ— æ³•æ‰“å¼€

**è§£å†³æ–¹æ¡ˆ**:
1. ç¡®è®¤åŸå§‹æ–‡æ¡£å¯ä»¥æ­£å¸¸æ‰“å¼€
2. æ£€æŸ¥ç£ç›˜ç©ºé—´æ˜¯å¦å……è¶³
3. å°è¯•ä½¿ç”¨Wordçš„ä¿®å¤åŠŸèƒ½

---

## æŠ€æœ¯æ”¯æŒ

å¦‚æœ‰å…¶ä»–é—®é¢˜ï¼Œè¯·ï¼š

1. æŸ¥çœ‹ [GitHub Issues](https://github.com/yourusername/word-format-restorer/issues)
2. æäº¤æ–°çš„Issue
3. å‘é€é‚®ä»¶è‡³: your.email@example.com

---

## æ›´æ–°æ—¥å¿—

### v0.1.0 (2024-01-08)

- âœ… æ ¸å¿ƒæ ¼å¼è¿˜åŸåŠŸèƒ½
- âœ… æ‰¹é‡å¤„ç†æ”¯æŒ
- âœ… æ ¼å¼å¯¹æ¯”éªŒè¯
- âœ… å‘½ä»¤è¡Œæ¥å£
- âœ… XMLè§„èŒƒåŒ–
- âœ… å†…å®¹ä¸€è‡´æ€§æ£€æŸ¥

---

## ä¸‹ä¸€æ­¥

- æŸ¥çœ‹ [éœ€æ±‚æ–‡æ¡£](éœ€æ±‚æ–‡æ¡£_Wordæ ¼å¼è¿˜åŸå·¥å…·.md) äº†è§£è¯¦ç»†çš„æŠ€æœ¯è§„æ ¼
- æŸ¥çœ‹ [README](../README.md) äº†è§£é¡¹ç›®æ¦‚è¿°
- æŸ¥çœ‹ [examples/](../examples/) ç›®å½•çš„æµ‹è¯•æ–‡æ¡£
